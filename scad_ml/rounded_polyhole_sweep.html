<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>rounded_polyhole_sweep (scad_ml.rounded_polyhole_sweep)</title><link rel="stylesheet" href="../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="index.html">Up</a> â€“ <a href="index.html">scad_ml</a> &#x00BB; rounded_polyhole_sweep</nav><header class="odoc-preamble"><h1 id="rounded-sweep-with-holes"><a href="#rounded-sweep-with-holes" class="anchor"></a>Rounded sweep with holes</h1><pre><code>open Scad_ml</code></pre><p>Create a bezier spline function which passes through all of points in <code>control</code> using <a href="Scad_ml/Bezier3/index.html#val-of_path"><code>Bezier3.of_path</code></a>, and interpolate <code>20</code> points along it to create our <code>path</code> with <a href="Scad_ml/Bezier3/index.html#val-curve"><code>Bezier3.curve</code></a>.</p><pre><code>let control = Vec3.[ v 0. 0. 2.; v 0. 20. 20.; v 40. 10. 0.; v 50. 10. 5. ]
let path = Bezier3.curve ~fn:20 @@ Bezier3.of_path control</code></pre><p>We can quickly visualize <code>path</code>, and the <code>control</code> points that it passes through by using the <a href="Scad_ml/Path3/index.html#val-show_points"><code>Path3.show_points</code></a> helper, which places a <a href="Scad_ml/Scad/index.html#type-d3"><code>Scad.d3</code></a> shape at each point along the path (this takes a function from index to shape, rather than a shape directly to allow for differentiating the points, <i>e.g.</i> numbering with <a href="Scad_ml/Scad/index.html#val-text"><code>Scad.text</code></a>).</p><pre><code>let () =
  Scad.to_file &quot;bezier_spline_path.scad&quot;
  @@ Scad.union
       [ Path3.show_points (fun _ -&gt; Scad.sphere 1.) path
       ; Path3.show_points
           (fun _ -&gt; Scad.(color ~alpha:0.3 Color.Magenta @@ sphere 2.))
           control
       ]</code></pre>
<p style="text-align:center;">
<img src="../assets/bezier_spline_path.png" style="width:150mm;"/>
</p> <p>Draw a 2d polygon with a chamfered square outline, and two circular holes. Chamfering the square outer path is accomplished via <a href="Scad_ml/Path2/index.html#val-roundover"><code>Path2.roundover</code></a>, which takes a <a href="Scad_ml/Path2/Round/index.html#type-t"><code>Path2.Round.t</code></a> specifation, built here using the <a href="Scad_ml/Path2/Round/index.html#val-flat"><code>Path2.Round.flat</code></a> constructor, that tells <a href="Scad_ml/Path2/index.html#val-roundover"><code>Path2.roundover</code></a> to apply <code>~corner</code> to all of the points of the given path.</p><pre><code>let poly =
  let holes =
    let s = Path2.circle ~fn:90 2.
    and d = 1.9 in
    Path2.[ translate (v2 (-.d) (-.d)) s; translate (v2 d d) s ]
  and outer =
    Path2.square ~center:true (v2 10. 10.)
    |&gt; Path2.Round.(flat ~corner:(chamf (`Width 2.)))
    |&gt; Path2.roundover
  in
  Poly2.make ~holes outer</code></pre><p>2d shapes defined with <a href="Scad_ml/Poly2/index.html#type-t"><code>Poly2.t</code></a> can be translated into OpenSCAD polygons by way of <a href="Scad_ml/Poly2/index.html#val-to_scad"><code>Poly2.to_scad</code></a>.</p><pre><code>let () = Scad.to_file &quot;chamfered_square_with_holes.scad&quot; (Poly2.to_scad poly)</code></pre>
<p style="text-align:center;">
<img src="../assets/chamfered_square_with_holes.png" style="width:150mm;"/>
</p> <p><a href="Scad_ml/Mesh/index.html#val-sweep"><code>Mesh.sweep</code></a> derived functions take a <code>~spec</code> parameter that specifies what to do with the end faces of the extruded mesh. By default, both caps are flat and identical to the input polygon (<a href="Scad_ml/Mesh/Cap/index.html#val-flat_caps"><code>Mesh.Cap.flat_caps</code></a>), but in this example, we will be rounding them over.</p><p>To build our <code>spec</code>, we'll use the <a href="Scad_ml/Mesh/Cap/index.html#val-capped"><code>Mesh.Cap.capped</code></a> constructor which takes specification types for how we would like to treat the bottom and top faces of our extrusion. In this case, we'll be applying roundovers to both the <code>bot</code>tom and <code>top</code> faces, so we use <a href="Scad_ml/Mesh/Cap/index.html#val-round"><code>Mesh.Cap.round</code></a> which takes an <a href="Scad_ml/Mesh/Cap/index.html#val-offsets"><code>Mesh.Cap.offsets</code></a> containing the offset distance/radius and &quot;vertical&quot; step for each outline of the outer roundover, and optionally, the desired treatment of the inner paths (as <code>~holes</code>). Typically, the offsets will be generated by a helper such as <a href="Scad_ml/Mesh/Cap/index.html#val-chamf"><code>Mesh.Cap.chamf</code></a> and <a href="Scad_ml/Mesh/Cap/index.html#val-circ"><code>Mesh.Cap.circ</code></a> below.</p><p>Here we apply a negative (outward flaring) chamfer to the bottom face, setting <code>holes</code> to <code>`Same</code>, so that the circular holes in <code>poly</code> are also expanded, rather than pinched off (default is (<code>~holes:`Flip</code>), which negates the outer roundover for inner paths). For the top face, we specify a positive (inward) circular roundover, leaving <code>holes</code> as its default since we want the holes to flare out instead.</p><pre><code>let spec =
  Mesh.Cap.(
    capped
      ~bot:(round ~holes:`Same @@ chamf ~height:(-1.2) ~angle:(Float.pi /. 8.) ())
      ~top:(round @@ circ (`Radius 0.5)))</code></pre><p>Extrude <code>poly</code> along <code>path</code>, with rounding over the end caps according to <code>spec</code> using <a href="Scad_ml/Mesh/index.html#val-path_extrude"><code>Mesh.path_extrude</code></a>.</p><pre><code>let mesh = Mesh.path_extrude ~path ~spec poly</code></pre><p>Convert our mesh into an OpenSCAD polyhedron and output to file with <a href="Scad_ml/Mesh/index.html#val-to_scad"><code>Mesh.to_scad</code></a>.</p><pre><code>let () = Scad.to_file &quot;rounded_polyhole_sweep.scad&quot; (Mesh.to_scad mesh)</code></pre>
<p style="text-align:center;">
<img src="../assets/rounded_polyhole_sweep.png" style="width:150mm;"/>
</p> </header><div class="odoc-content"></div></body></html>